# Prompt: Generate Comprehensive Tests for `holidays.py`

You are a senior software development and testing expert who writes thorough, structured, regression-safe pytest suites.  

I’ll give you a Python file named `holiday_smart.py`, which implements holiday calendar utilities and a function called `detrend`.  

Your task: generate a complete pytest suite that tests this module exhaustively for functional correctness, stability, and regression behavior.  

---

## Requirements

1. Create a file called `tests/test_holiday_smart.py`.  
2. The test file must begin with this comment:  
   # This test suite was initially generated by ChatGPT (GPT-5) and then edited by a human.
3. The tests should be grouped into three sections:  
   - A) get_calendar tests  
   - B) detrend tests  
   - C) Edge/Regression tests  
4. Use pytest and pandas.testing conventions. 

---

## Test coverage specification

### A) get_calendar

- A0: Sanity test that checks the external holidays package version and confirms a known holiday date (July 4, 2024 → US Independence Day) to guard against holiday package drift.
- A1: Full parity with the external holidays package for all holidays in 2024 for both the US and France. The test should transform names exactly as get_calendar does (prefixing, (observed) cleanup, “Day off (substituted …)” normalization, semicolon handling).  
- A2: Confirm observed-name cleanup and correct prefixing for US 2017.  
- A3: Use a synthetic subclass of holidays.HolidayBase that defines "Foo Day off (substituted from 2024-05-01)" and verify normalization to "US Foo day off (substituted)".  
- A4/A5: For Iran 2025, test additional_holidays=[IranInternetBlackout] with and without split_concurrent_holidays; no collisions expected.  
- A6: Include/exclude Paschal-cycle holidays (France should include Easter; Japan should not).  
- A7: Verify sorting and uniqueness of (submission_date, holiday) when split_concurrent_holidays=True.  

### B) detrend

- B0: Shape/finite invariants for a flat baseline and single holiday.  
- B1: Parameterization smoke tests across (min_radius, max_radius), threshold, and spike_correction combinations.  
- B2: Behavior when holiday_df is empty (allow exception or handle gracefully).  
- B3: Non-aligned holiday dates (inside + outside range).  
- B4: Synthetic “actual behavior” regression test:  
  - 60 days (2025-05-15 → 2025-07-13).  
  - Baseline linearly decreasing 100 → 90.  
  - One holiday in the middle day (index 29, date 2025-06-13).  
  - Inject a deeper drop to 80.  
  - Expected output: same decreasing baseline but with a small triangular dip (−5, −10, −5) around that day.  
  - Use np.allclose to compare output to the recorded expected array.  
  - Include an environment variable UPDATE_B4_GOLDEN mechanism to refresh the recorded values if needed.  

### C) Edge and regression tests

- C1: Large input (5 years of daily data) performance sanity.  
- C2: Idempotence wrt extra columns and shuffled column order in holiday_df.  

---

## General notes

- Write helpers where appropriate (e.g., _simple_holiday_df, _transform_baseline_to_match_impl).  
- Ensure all tests are deterministic, finite, and can run quickly.  
- Use descriptive assertions and inline comments to explain intent.  
- Don’t run the tests in this session—just generate the code file.
